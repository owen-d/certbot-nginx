#!/bin/sh

set -e

if [ ! "${DOMAINS}" ]
then
    echo must set required argument DOMAINS >&2
    exit 1
fi

CERT_DIR=/etc/ssl/acme
DOMAIN={{ var "DOMAINS" | printf `/usr/local/bin/trim-domain "%s"` | sh }}

if [ ! -f $CERT_DIR/$DOMAIN/$DOMAIN.cer ] || [ ! -f $CERT_DIR/$DOMAIN/$DOMAIN.key ];
then
    echo generating initial certs...
    STANDALONE=1 /usr/local/bin/gen-certs
else
    echo certs exist...
fi
